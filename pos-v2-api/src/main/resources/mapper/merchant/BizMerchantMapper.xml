<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cykj.pos.mapper.BizMerchantMapper">

    <resultMap type="BizMerchant" id="BizMerchantResult">
        <result property="merchId"    column="merch_id"    />
        <result property="userId"    column="user_id"    />
        <result property="parentId"    column="parent_id"    />
        <result property="merchCode"    column="merch_code"    />
        <result property="merchName"    column="merch_name"    />
        <result property="merchAbbr"    column="merch_abbr"    />
        <result property="merchRegion"    column="merch_region"    />
        <result property="merchAddr"    column="merch_addr"    />
        <result property="merchBizScope"    column="merch_biz_scope"    />
        <result property="merchType"    column="merch_type"    />
        <result property="verifyStatus"    column="verify_status"    />
        <result property="verifyResult"    column="verify_result"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="secretKey"    column="secret_key"    />
        <result property="secretBalance"    column="secret_balance"    />
        <result property="var1"    column="var1"    />
        <result property="var2"    column="var2"    />
        <result property="var3"    column="var3"    />
        <result property="var4"    column="var4"    />
        <result property="var5"    column="var5"    />
    </resultMap>


    <select id="selectPagedPartnerList" resultType="MerchantDict" parameterType="MerchantDTO">
        select m.merch_id dictValue,m.user_id userId,m.merch_name dictLabel,h.merch_bank_mobile mobile,u.portrait portrait
        from biz_merchant m
        left join biz_micro_info h on  h.merch_id = m.merch_id
        left join sys_user u on m.user_id=u.user_id
        where m.merch_id in(
        select parent_id from biz_merchant where parent_id!=0)
        and m.parent_id=#{merchId}
        <if test="nickName!=null and nickName!=''">
            and merch_name like concat('%',#{nickName},'%')
        </if>
        order by m.create_time asc
        <if test="pageNo!=-1 and pageSize!=-1"><!-- 分页 -->
            limit #{start},#{pageSize}
        </if>
    </select>

    <select id="getMonthlyNewPartnerCount" parameterType="HomePageDTO" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM biz_merchant
        WHERE parent_id=#{merchId} AND create_time LIKE CONCAT(#{yearMonth},'%')
    </select>
    <!--新增商户  也就是激活的pos机器数量-->
    <select id="getMonthlyNewMerchCounts" parameterType="HomePageDTO" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM biz_pos_machine WHERE merch_id=#{merchId}
        <if test="yearMonth!=null and yearMonth!=''">
            AND create_time LIKE CONCAT(#{yearMonth},'%')
        </if>
        AND pos_code IN (
            SELECT sn_code FROM biz_pos_machine_status_records WHERE Records_type='2'
        )
    </select>
</mapper>
